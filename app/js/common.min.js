function showModal(i){$("#cart .modal-body").html(i);var t=$("#image").attr("src");$("#img_modal").attr("src",t),$("#cart").modal()}function readURL(i){if(isValidPicture(i)){$("#panel-heading").removeClass("succ-error").html("");var t=new FileReader;t.onload=function(i){$("#image").attr("src",i.target.result)},t.readAsDataURL(i.files[0])}else $("#image").attr("src","#")}function isValidEmail(i){return new RegExp(/^[-._a-z0-9]+@(?:[a-z0-9][-a-z0-9]+\.)+[a-z]{2,6}$/).test(i)}function isValidContent(i){if(i.length>0&&i.length<1e3)return!0}function isValidFileExt(i){return new RegExp(/^(.*\.(?!(jpg|png|gif)$))?[^.]*$/).test(i)}function isValidPicture(i){if(i.files&&i.files[0])return isValidFileExt(i.files[0].name)?($("#panel-heading").addClass("succ-error").html("<p>Не верный тип файла. Допустимые форматы - jpg, png, gif.</p>"),!1):!(i.files[0].size>5242880)||($("#panel-heading").addClass("succ-error").html("<p>Размер файла не должен превышать 5 Мб.</p>"),!1)}function checkFile(i){return!isValidFileExt(i)&&!($("#imgInput")[0].files[0].size>5242880)}$(document).ready(function(){$("#form_login").submit(function(){var i=$(this),t=!1;if(i.find("input").each(function(){$(this).val().trim()?($(this).removeClass("is-invalid"),$(this).next().css("display","none").html("")):(t=!0,$(this).addClass("is-invalid"),$(this).next().css("display","block").html("Заполните поле."),$("#error-auth").css("display","none").html(""))}),!t){var a=i.serialize();$.ajax({type:"POST",url:"/login/",dataType:"json",data:a,beforeSend:function(t){i.find('button[type="submit"]').attr("disabled","disabled")},success:function(i){if("bad"==i.type)$("#error-auth").css("display","block").html("Неверный логин или пароль!");else if("good"==i.type){$(location).attr("href","/")}},error:function(i,t,a){alert(i.status),alert(a)},complete:function(t){i.find('button[type="submit"]').prop("disabled",!1)}})}return!1}),$("#myTable").tablesorter({selectorHeaders:"thead th.sortable"}),$("#imgInput").change(function(){readURL(this)}),$("#buttonPreview").on("click",function(){var i=!1,t=$("#author").val();t.length<3||t.length>20?($("#author").addClass("is-invalid"),$("#author").next().css("display","block").html("Поле Автор должно иметь от 3 до 20 символов."),i=!0):($("#author").removeClass("is-invalid"),$("#author").next().css("display","none").html(""));var a=$("#email").val();isValidEmail(a)?($("#email").removeClass("is-invalid"),$("#email").next().css("display","none").html("")):($("#email").addClass("is-invalid"),$("#email").next().css("display","block").html("Введите корректный email адрес."),i=!0);var e=$("#content").val();if(isValidContent(e)?($("#content").removeClass("is-invalid"),$("#content").next().css("display","none").html("")):($("#content").addClass("is-invalid"),$("#content").next().css("display","block").html("Поле текст задачи должно иметь от 1 до 1000 символов."),i=!0),!i){var s=!1;if((l=$("#imgInput").val())&&(checkFile(l)||(s=!0)),!s){var l,n=new FormData,r=(l=$(document).find('input[type="file"]'))[0].files[0];n.append("file",r),n.append("author",t),n.append("email",a),n.append("content",e),$.ajax({type:"POST",url:"/tasks/preview/",data:n,cache:!1,contentType:!1,processData:!1,success:function(i){i||alert("Ошибка"),showModal(i)},error:function(i,t,a){alert(i.status),alert(a)}})}}}),$("#form_task").submit(function(){var i=!1;if($(this).find("#author, #email, #content").each(function(){$(this).val().trim()?($(this).removeClass("is-invalid"),$(this).next().css("display","none").html("")):(i=!0,$(this).addClass("is-invalid"),$(this).next().css("display","block").html("Заполните поле."))}),!i){var t=$("#author").val();if(t.length<3||t.length>20)$("#author").addClass("is-invalid"),$("#author").next().css("display","block").html("Поле Автор должно иметь от 3 до 20 символов.");else if(isValidEmail($("#email").val()))if(isValidContent($("#content").val())){var a=!1,e=$("#imgInput").val();if(e){if(isValidFileExt(e))$("#panel-heading").addClass("succ-error").html("<p>Не верный тип файла. Допустимые форматы - jpg, png, gif.</p>"),a=!0;else if($("#imgInput")[0].files[0].size>5242880)$("#panel-heading").addClass("succ-error").html("<p>Размер файла не должен превышать 5 Мб.</p>"),a=!0;else a=!1}if(!a)return!0}else $("#content").addClass("is-invalid"),$("#content").next().css("display","block").html("Поле текст задачи должно иметь от 1 до 1000 символов.");else $("#email").addClass("is-invalid"),$("#email").next().css("display","block").html("Введите корректный email адрес.")}return!1})});