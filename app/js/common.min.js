function showModal(e){$("#cart .modal-body").html(e);var i=$("#image").attr("src");$("#img_modal").attr("src",i),$("#cart").modal()}function readURL(e){if(isValidPicture(e)){$("#panel-heading").removeClass("succ-error").html("");var i=new FileReader;i.onload=function(e){$("#image").attr("src",e.target.result)},i.readAsDataURL(e.files[0])}else $("#image").attr("src","#")}function isValidEmail(e){return new RegExp(/^[-._a-z0-9]+@(?:[a-z0-9][-a-z0-9]+\.)+[a-z]{2,6}$/).test(e)}function isValidContent(e){if(e.length>0&&e.length<1e3)return!0}function isValidContentCkeditor(e){if(e.length>0&&e.length<1e3)return!0}function isValidFileExt(e){return new RegExp(/^(.*\.(?!(jpg|png|gif)$))?[^.]*$/).test(e)}function isValidPicture(e){if(e.files&&e.files[0])return isValidFileExt(e.files[0].name)?($("#panel-heading").addClass("succ-error").html("<p>Не верный тип файла. Допустимые форматы - jpg, png, gif.</p>"),!1):!(e.files[0].size>5242880)||($("#panel-heading").addClass("succ-error").html("<p>Размер файла не должен превышать 5 Мб.</p>"),!1)}function checkFile(e){return!isValidFileExt(e)&&!($("#imgInput")[0].files[0].size>5242880)}$(document).ready(function(){CKEDITOR.replace("content"),$("#form_login").submit(function(){var e=$(this),i=!1;if(e.find("input").each(function(){$(this).val().trim()?($(this).removeClass("is-invalid"),$(this).next().css("display","none").html("")):(i=!0,$(this).addClass("is-invalid"),$(this).next().css("display","block").html("Заполните поле."),$("#error-auth").css("display","none").html(""))}),!i){var t=e.serialize();$.ajax({type:"POST",url:"/login/",dataType:"json",data:t,beforeSend:function(i){e.find('button[type="submit"]').attr("disabled","disabled")},success:function(e){if("bad"==e.type)$("#error-auth").css("display","block").html("Неверный логин или пароль!");else if("good"==e.type){$(location).attr("href","/")}},error:function(e,i,t){alert(e.status),alert(t)},complete:function(i){e.find('button[type="submit"]').prop("disabled",!1)}})}return!1}),$("#myTable").tablesorter({selectorHeaders:"thead th.sortable"}),$("#imgInput").change(function(){readURL(this)}),$("#buttonPreview").on("click",function(){var e=!1,i=$("#author").val();i.length<3||i.length>20?($("#author").addClass("is-invalid"),$("#author").next().css("display","block").html("Поле Автор должно иметь от 3 до 20 символов."),e=!0):($("#author").removeClass("is-invalid"),$("#author").next().css("display","none").html(""));var t=$("#email").val();isValidEmail(t)?($("#email").removeClass("is-invalid"),$("#email").next().css("display","none").html("")):($("#email").addClass("is-invalid"),$("#email").next().css("display","block").html("Введите корректный email адрес."),e=!0);var a=CKEDITOR.instances.content.getData();if(isValidContentCkeditor(a)?($("#cke_content").css("border","none"),$("#ckedit").css("display","block").html("")):($("#cke_content").css("border","1px solid red"),$("#ckedit").css("display","block").html("Поле текст задачи должно иметь от 1 до 1000 символов."),e=!0),!e){var s=!1;if((l=$("#imgInput").val())&&(checkFile(l)||(s=!0)),!s){var l,n=new FormData,r=(l=$(document).find('input[type="file"]'))[0].files[0];n.append("file",r),n.append("author",i),n.append("email",t),n.append("content",a),$.ajax({type:"POST",url:"/tasks/preview/",data:n,cache:!1,contentType:!1,processData:!1,success:function(e){e||alert("Ошибка"),showModal(e)},error:function(e,i,t){alert(e.status),alert(t)}})}}}),$("#form_task").submit(function(){var e=!1;if($(this).find("#author, #email").each(function(){$(this).val().trim()?($(this).removeClass("is-invalid"),$(this).next().css("display","none").html("")):(e=!0,$(this).addClass("is-invalid"),$(this).next().css("display","block").html("Заполните поле."))}),!e){var i=$("#author").val();if(i.length<3||i.length>20)$("#author").addClass("is-invalid"),$("#author").next().css("display","block").html("Поле Автор должно иметь от 3 до 20 символов.");else if(isValidEmail($("#email").val()))if(isValidContentCkeditor(CKEDITOR.instances.content.getData())){var t=!1,a=$("#imgInput").val();if(a){if(isValidFileExt(a))$("#panel-heading").addClass("succ-error").html("<p>Не верный тип файла. Допустимые форматы - jpg, png, gif.</p>"),t=!0;else if($("#imgInput")[0].files[0].size>5242880)$("#panel-heading").addClass("succ-error").html("<p>Размер файла не должен превышать 5 Мб.</p>"),t=!0;else t=!1}if(!t)return!0}else $("#cke_content").css("border","1px solid red"),$("#ckedit").css("display","block").html("Поле текст задачи должно иметь от 1 до 1000 символов.");else $("#email").addClass("is-invalid"),$("#email").next().css("display","block").html("Введите корректный email адрес.")}return!1})});